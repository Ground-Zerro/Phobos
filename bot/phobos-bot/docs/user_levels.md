# –£—Ä–æ–≤–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (User Levels)

## –û–±–∑–æ—Ä

Phobos Bot –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º—É —É—Ä–æ–≤–Ω–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏. –£—Ä–æ–≤–µ–Ω—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã, –ª–∏–º–∏—Ç—ã –∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã `users`

```sql
CREATE TABLE users (
    user_id INTEGER PRIMARY KEY,              -- ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram
    username TEXT NOT NULL,                    -- –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (@username)
    user_level TEXT DEFAULT 'basic',          -- –£—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–∞
    premium_expires_at DATETIME,              -- –î–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è –ø—Ä–µ–º–∏—É–º-—Å—Ç–∞—Ç—É—Å–∞
    premium_reason TEXT,                      -- –ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø—Ä–µ–º–∏—É–º–∞
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,  -- –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP   -- –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
);
```

## –î–æ—Å—Ç—É–ø–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 1. Basic (–û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)

**–ó–Ω–∞—á–µ–Ω–∏–µ:** `user_level = 'basic'`

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –¥–ª—è –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –ò–º–µ–µ—Ç –±–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏.

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
- `/start` - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ
- `/create` - —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (—Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏)
- `/stat` - —Å—Ç–∞—Ç—É—Å —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `/delete` - —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `/info` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–∏—Å–µ
- `/selfhost` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–º —Ö–æ—Å—Ç–∏–Ω–≥–µ
- `/help` - —Å–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º
- `/feedback` - –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
- `/premium` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–µ–º–∏—É–º-—Å—Ç–∞—Ç—É—Å–µ

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- ‚è± **–¢–µ—Å—Ç–æ–≤—ã–π –ø–µ—Ä–∏–æ–¥**: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω `max_test_duration` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 72 —á–∞—Å–∞ —Å –º–æ–º–µ–Ω—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
  - –ü–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è: –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –ö–†–û–ú–ï `/create`
  - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞, —É–¥–∞–ª–µ–Ω–∏–µ, feedback –æ—Å—Ç–∞—é—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏
- üîÑ **Rate limiting**: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã `/create`
- üóë **Watchdog**: –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è –ø—Ä–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ > `watchdog_inactive_threshold` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 24 —á–∞—Å–∞)
- üìä **–õ–∏–º–∏—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π**: —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –æ–±—â–µ–º –ø—É–ª–µ `max_clients`
- üÜï **–ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏**: –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –¥–ª—è –Ω–æ–≤—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)

**–°–≤—è–∑–∞–Ω–Ω—ã–µ –ø–æ–ª—è —Ç–∞–±–ª–∏—Ü—ã:**
- `premium_expires_at`: NULL
- `premium_reason`: NULL
- `created_at`: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞

**–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –¥—Ä—É–≥–æ–π —É—Ä–æ–≤–µ–Ω—å:**
```sql
-- –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ SQL
UPDATE users SET user_level = 'premium' WHERE user_id = 123456789;

-- –ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
/setlevel 123456789 premium
/setpremium 123456789 30  -- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è premium
```

---

### 2. Premium (–ü—Ä–µ–º–∏—É–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)

**–ó–Ω–∞—á–µ–Ω–∏–µ:** `user_level = 'premium'`

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ü–ª–∞—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–∞ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏—è–º–∏ –∏ —Å–Ω—è—Ç–∏–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
–í—Å–µ –∫–æ–º–∞–Ω–¥—ã —É—Ä–æ–≤–Ω—è Basic –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

**–ü—Ä–∏–≤–∏–ª–µ–≥–∏–∏:**
- ‚úÖ **–ë–µ–∑ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞**: `/create` –¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–≥–¥–∞, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç `max_test_duration`
- ‚úÖ **–ë–µ–∑ rate limiting**: –∫–æ–º–∞–Ω–¥–∞ `/create` –¥–æ—Å—Ç—É–ø–Ω–∞ –±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫
- ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç watchdog**: –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ù–ï —É–¥–∞–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- ‚úÖ **–í–Ω–µ –ª–∏–º–∏—Ç–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π**: –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ `max_clients`
- ‚úÖ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
–ù–µ—Ç (–∫—Ä–æ–º–µ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–µ–º–∏—É–º–∞)

**–°–≤—è–∑–∞–Ω–Ω—ã–µ –ø–æ–ª—è —Ç–∞–±–ª–∏—Ü—ã:**

#### `premium_expires_at` (DATETIME, nullable)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è –ø—Ä–µ–º–∏—É–º-—Å—Ç–∞—Ç—É—Å–∞

**–í–æ–∑–º–æ–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:**
- `NULL` - –±–µ—Å—Å—Ä–æ—á–Ω—ã–π –ø—Ä–µ–º–∏—É–º
- `YYYY-MM-DD HH:MM:SS` - –¥–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä—ã:**
```sql
-- –ü—Ä–µ–º–∏—É–º –¥–æ 31 –¥–µ–∫–∞–±—Ä—è 2025
premium_expires_at = '2025-12-31 23:59:59'

-- –ë–µ—Å—Å—Ä–æ—á–Ω—ã–π –ø—Ä–µ–º–∏—É–º
premium_expires_at = NULL
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```sql
-- –ê–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–µ–º–∏—É–º-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
SELECT * FROM users
WHERE user_level = 'premium'
AND (premium_expires_at IS NULL OR premium_expires_at > datetime('now'));

-- –ò—Å—Ç–µ–∫—à–∏–µ –ø—Ä–µ–º–∏—É–º-–∞–∫–∫–∞—É–Ω—Ç—ã
SELECT * FROM users
WHERE user_level = 'premium'
AND premium_expires_at IS NOT NULL
AND premium_expires_at <= datetime('now');
```

**–õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```go
// –ò–∑ internal/database/user_repository.go
func (ur *UserRepository) IsPremium(userID int64) (bool, error) {
    // –ê–¥–º–∏–Ω—ã –∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã –≤—Å–µ–≥–¥–∞ premium
    if userLevel == "admin" || userLevel == "moderator" {
        return true, nil
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω—è premium
    if userLevel != "premium" {
        return false, nil
    }

    // –ï—Å–ª–∏ –¥–∞—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞ (NULL) - –±–µ—Å—Å—Ä–æ—á–Ω—ã–π
    if !expiresAt.Valid {
        return true, nil
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
    return time.Now().Before(expiresAt.Time), nil
}
```

#### `premium_reason` (TEXT, nullable)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø—Ä–µ–º–∏—É–º-—Å—Ç–∞—Ç—É—Å–∞ (–¥–ª—è —É—á–µ—Ç–∞)

**–ü—Ä–∏–º–µ—Ä—ã –∑–Ω–∞—á–µ–Ω–∏–π:**
- `"–û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ PayPal, invoice #12345"`
- `"–ü—Ä–æ–¥–ª–µ–Ω–∏–µ, –∫–∞—Ä—Ç–∞ ****1234"`
- `"–°–ø–æ–Ω—Å–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞"`
- `"–ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –∑–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã"`
- `"–¢–µ—Å—Ç–æ–≤—ã–π –¥–æ—Å—Ç—É–ø –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞"`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```sql
-- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ SQL
UPDATE users
SET premium_reason = '–û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Stripe, #invoice-67890'
WHERE user_id = 123456789;

-- –ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É /setpremium (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
/setpremium 123456789 30 –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ PayPal
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –ü–æ–ª–µ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–ø–æ–ª–Ω—è—Ç—å –¥–ª—è –∞—É–¥–∏—Ç–∞
- –ü–æ–º–æ–≥–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –ø—Ä–µ–º–∏—É–º-–¥–æ—Å—Ç—É–ø–∞
- –ü–æ–ª–µ–∑–Ω–æ –ø—Ä–∏ —Ä–∞–∑–±–æ—Ä–µ —Å–ø–æ—Ä–æ–≤ –∏ –≤–æ–∑–≤—Ä–∞—Ç–∞—Ö

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–µ–º–∏—É–º-—Å—Ç–∞—Ç—É—Å–∞:**
```bash
# –ü—Ä–µ–º–∏—É–º –Ω–∞ 30 –¥–Ω–µ–π —Å –ø—Ä–∏—á–∏–Ω–æ–π
/setpremium 123456789 30 –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ PayPal, #invoice-12345

# –ë–µ—Å—Å—Ä–æ—á–Ω—ã–π –ø—Ä–µ–º–∏—É–º
/setpremium 987654321 permanent –°–ø–æ–Ω—Å–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

# –¢–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ SQL (–±–µ–∑ –ø—Ä–∏—á–∏–Ω—ã)
UPDATE users
SET user_level = 'premium',
    premium_expires_at = datetime('now', '+30 days'),
    updated_at = CURRENT_TIMESTAMP
WHERE user_id = 123456789;
```

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:**
- –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ `IsPremium()`
- –ò—Å—Ç–µ–∫—à–∏–π –ø—Ä–µ–º–∏—É–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ç–µ—Ä—è–µ—Ç –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ (–Ω–æ —É—Ä–æ–≤–µ–Ω—å –æ—Å—Ç–∞–µ—Ç—Å—è 'premium')
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞—Ç—å –∏—Å—Ç–µ–∫—à–∏–µ –∞–∫–∫–∞—É–Ω—Ç—ã:
```sql
UPDATE users
SET user_level = 'basic',
    premium_expires_at = NULL,
    premium_reason = NULL
WHERE user_level = 'premium'
AND premium_expires_at IS NOT NULL
AND premium_expires_at <= datetime('now');
```

---

### 3. Moderator (–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä)

**–ó–Ω–∞—á–µ–Ω–∏–µ:** `user_level = 'moderator'`

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ü—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã.

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
–í—Å–µ –∫–æ–º–∞–Ω–¥—ã Premium + –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
- `/logs` - –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ —Å–æ–±—ã—Ç–∏–π
- `/users` - —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `/feedbacklist` - —Å–ø–∏—Å–æ–∫ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏

**–ü—Ä–∏–≤–∏–ª–µ–≥–∏–∏:**
- ‚úÖ **–í—Å–µ –ø—Ä–µ–º–∏—É–º-–ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏**: –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π, –∑–∞—â–∏—Ç–∞ –æ—Ç watchdog, –≤–Ω–µ –ª–∏–º–∏—Ç–æ–≤
- ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –¥–æ—Å—Ç—É–ø –∫ –ª–æ–≥–∞–º –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞**: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–µ–º–∏—É–º**: `IsPremium()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `true` –¥–ª—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- ‚ùå **–ù–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏**: –Ω–µ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å —É—Ä–æ–≤–Ω–∏ –∏–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
- ‚ùå **–ù–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã**: –Ω–µ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚ùå **–ù–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏**

**–°–≤—è–∑–∞–Ω–Ω—ã–µ –ø–æ–ª—è —Ç–∞–±–ª–∏—Ü—ã:**
- `premium_expires_at`: –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è (–º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã –≤—Å–µ–≥–¥–∞ –∏–º–µ—é—Ç –ø—Ä–µ–º–∏—É–º-–ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏)
- `premium_reason`: –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–º

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞:**
```bash
# –ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
/setlevel 123456789 moderator

# –ò–ª–∏ —á–µ—Ä–µ–∑ SQL
UPDATE users
SET user_level = 'moderator',
    updated_at = CURRENT_TIMESTAMP
WHERE user_id = 123456789;
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã –ø–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤–æ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
- –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ feedback –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–º, –¥—Ä—É–≥–∏–µ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ –∫–Ω–æ–ø–∫—É "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ"
- –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –±–µ–∑ –ø–æ–ª–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

---

### 4. Admin (–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)

**–ó–Ω–∞—á–µ–Ω–∏–µ:** `user_level = 'admin'`

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–í—ã—Å—à–∏–π —É—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–∞ —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –Ω–∞–¥ —Å–∏—Å—Ç–µ–º–æ–π.

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
–í—Å–µ –∫–æ–º–∞–Ω–¥—ã Moderator + –∫–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–æ–π:
- `/setlevel` - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `/setpremium` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–µ–º–∏—É–º-—Å—Ç–∞—Ç—É—Å–∞
- `/block` - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `/unblock` - —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `/config` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π —Å–∏—Å—Ç–µ–º—ã
- `/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã
- `/cleanuplogs` - –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤
- `/backup` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏

**–ü—Ä–∏–≤–∏–ª–µ–≥–∏–∏:**
- ‚úÖ **–ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å**: –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞
- ‚úÖ **–í—Å–µ –ø—Ä–µ–º–∏—É–º-–ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏**: –∏–∑–º–µ–Ω–µ–Ω–∏–µ —É—Ä–æ–≤–Ω–µ–π, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
- ‚úÖ **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã**: –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- ‚úÖ **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ**: —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
- ‚úÖ **–ü–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ feedback**: –æ—Ç–≤–µ—Ç—ã, –∏–∑–º–µ–Ω–µ–Ω–∏–µ —É—Ä–æ–≤–Ω–µ–π, —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
–ù–µ—Ç

**–°–≤—è–∑–∞–Ω–Ω—ã–µ –ø–æ–ª—è —Ç–∞–±–ª–∏—Ü—ã:**
- `premium_expires_at`: –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è
- `premium_reason`: –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:**
```bash
# –¢–û–õ–¨–ö–û —á–µ—Ä–µ–∑ SQL (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å!)
# –ü–µ—Ä–≤—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é
UPDATE users
SET user_level = 'admin',
    updated_at = CURRENT_TIMESTAMP
WHERE user_id = 1458954246;

# –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É –¥—Ä—É–≥–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
/setlevel 987654321 admin
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- ‚ö†Ô∏è –ë—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã —Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ (2-3)
- –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- –ü–µ—Ä–≤—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ SQL

---

## –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä | Basic | Premium | Moderator | Admin |
|----------|-------|---------|-----------|-------|
| **–î–æ—Å—Ç—É–ø –∫ /create** | –û–≥—Ä–∞–Ω–∏—á–µ–Ω —Ç–µ—Å—Ç–æ–≤—ã–º –ø–µ—Ä–∏–æ–¥–æ–º | –ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π | –ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π | –ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π |
| **Rate limiting** | –î–∞ | –ù–µ—Ç | –ù–µ—Ç | –ù–µ—Ç |
| **Watchdog —É–¥–∞–ª–µ–Ω–∏–µ** | –î–∞ | –ù–µ—Ç | –ù–µ—Ç | –ù–µ—Ç |
| **–£—á–µ—Ç –≤ max_clients** | –î–∞ | –ù–µ—Ç | –ù–µ—Ç | –ù–µ—Ç |
| **–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è** | - | premium_expires_at | - | - |
| **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (/logs, /users)** | –ù–µ—Ç | –ù–µ—Ç | –î–∞ | –î–∞ |
| **–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å (/feedbacklist)** | –ù–µ—Ç | –ù–µ—Ç | –î–∞ | –î–∞ |
| **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏** | –ù–µ—Ç | –ù–µ—Ç | –ù–µ—Ç | –î–∞ |
| **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã** | –ù–µ—Ç | –ù–µ—Ç | –ù–µ—Ç | –î–∞ |
| **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ** | –ù–µ—Ç | –ù–µ—Ç | –ù–µ—Ç | –î–∞ |

---

## –ó–∞–≤–∏—Å–∏–º—ã–µ –ø–æ–ª—è —Ç–∞–±–ª–∏—Ü—ã `users`

### `created_at` (DATETIME, NOT NULL)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –†–∞—Å—á–µ—Ç —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ –¥–ª—è basic –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–æ—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –±–∞–∑—ã
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ "–Ω–æ–≤—ã—Ö" –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞:**
```go
// –ò–∑ internal/handler.go
if !isPremium && !isPrivileged && h.config.MaxTestDuration > 0 {
    if time.Since(user.CreatedAt) >= h.config.MaxTestDuration {
        // –¢–µ—Å—Ç–æ–≤—ã–π –ø–µ—Ä–∏–æ–¥ –∏—Å—Ç–µ–∫
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø—Ä–µ–º–∏—É–º–∞
    }
}
```

**SQL –∑–∞–ø—Ä–æ—Å—ã:**
```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ–≥–æ–¥–Ω—è
SELECT * FROM users WHERE DATE(created_at) = DATE('now');

-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –∏—Å—Ç–µ–∫—à–∏–º —Ç–µ—Å—Ç–æ–≤—ã–º –ø–µ—Ä–∏–æ–¥–æ–º (72 —á–∞—Å–∞)
SELECT * FROM users
WHERE user_level = 'basic'
AND created_at < datetime('now', '-72 hours');

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π –ø–æ –¥–Ω—è–º
SELECT DATE(created_at) as date, COUNT(*) as count
FROM users
GROUP BY DATE(created_at)
ORDER BY date DESC;
```

---

### `updated_at` (DATETIME, NOT NULL)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:**
–ü—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è (`/setlevel`)
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–µ–º–∏—É–º–∞ (`/setpremium`)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ê—É–¥–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

**SQL –∑–∞–ø—Ä–æ—Å—ã:**
```sql
-- –ù–µ–¥–∞–≤–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
SELECT * FROM users
WHERE updated_at > datetime('now', '-7 days')
ORDER BY updated_at DESC;

-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –±–æ–ª–µ–µ –≥–æ–¥–∞
SELECT * FROM users
WHERE updated_at < datetime('now', '-1 year');
```

---

### `username` (TEXT, NOT NULL)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** Telegram username –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –ú–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å—Å—è (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–µ–Ω—è–µ—Ç @username –≤ Telegram)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ –ª–æ–≥–∞—Ö –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö
- –ò–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –ù–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —É–¥–∞–ª—è—Ç—å username)

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:**
```go
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏
err := h.userRepo.RegisterUser(update.Message.From.ID, update.Message.From.UserName)
```

---

### `user_id` (INTEGER, PRIMARY KEY)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á —Ç–∞–±–ª–∏—Ü—ã

---

## –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π

### `IsPremium()` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–º–∏—É–º-—Å—Ç–∞—Ç—É—Å–∞

```go
func (ur *UserRepository) IsPremium(userID int64) (bool, error) {
    var userLevel string
    var expiresAt sql.NullTime

    // –ü–æ–ª—É—á–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –∏ –¥–∞—Ç—É –∏—Å—Ç–µ—á–µ–Ω–∏—è
    err := ur.db.QueryRow(`
        SELECT user_level, premium_expires_at
        FROM users
        WHERE user_id = ?
    `, userID).Scan(&userLevel, &expiresAt)

    // Admin –∏ Moderator –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–º–∏—É–º
    if userLevel == "admin" || userLevel == "moderator" {
        return true, nil
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ premium —É—Ä–æ–≤–Ω—è
    if userLevel != "premium" {
        return false, nil
    }

    // NULL = –±–µ—Å—Å—Ä–æ—á–Ω—ã–π –ø—Ä–µ–º–∏—É–º
    if !expiresAt.Valid {
        return true, nil
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
    return time.Now().Before(expiresAt.Time), nil
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- `true` - –¥–ª—è admin, moderator, –∏–ª–∏ –¥–µ–π—Å—Ç–≤—É—é—â–µ–≥–æ premium
- `false` - –¥–ª—è basic –∏–ª–∏ –∏—Å—Ç–µ–∫—à–µ–≥–æ premium

---

### `checkPrivilege()` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω—è –¥–æ—Å—Ç—É–ø–∞

```go
func (h *BotHandler) checkPrivilege(user *User, requiredLevel UserLevel) bool {
    userLevel := user.UserLevel

    switch requiredLevel {
    case Admin:
        return userLevel == string(Admin)
    case Moderator:
        return userLevel == string(Admin) || userLevel == string(Moderator)
    case Premium:
        isPremium, _ := h.userRepo.IsPremium(user.UserID)
        return isPremium
    case Basic:
        return true
    default:
        return false
    }
}
```

**–ò–µ—Ä–∞—Ä—Ö–∏—è:**
- Admin –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ Moderator, Premium, Basic
- Moderator –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ Premium, Basic (–Ω–æ –ù–ï Admin)
- Premium –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ Basic
- Basic –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ Basic

---

## –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã —Å —É—Ä–æ–≤–Ω—è–º–∏

### –ü—Ä–∏–º–µ—Ä 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```sql
INSERT INTO users (user_id, username, user_level, created_at, updated_at)
VALUES (123456789, 'newuser', 'basic', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- `user_level = 'basic'`
- `premium_expires_at = NULL`
- `premium_reason = NULL`
- –¢–µ—Å—Ç–æ–≤—ã–π –ø–µ—Ä–∏–æ–¥ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `created_at`

---

### –ü—Ä–∏–º–µ—Ä 2: –ü—Ä–æ–¥–∞–∂–∞ –ø—Ä–µ–º–∏—É–º–∞ –Ω–∞ 30 –¥–Ω–µ–π
```bash
/setpremium 123456789 30 –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ PayPal, invoice #12345
```

**SQL —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç:**
```sql
UPDATE users
SET user_level = 'premium',
    premium_expires_at = datetime('now', '+30 days'),
    premium_reason = '–û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ PayPal, invoice #12345',
    updated_at = CURRENT_TIMESTAMP
WHERE user_id = 123456789;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- `user_level = 'premium'`
- `premium_expires_at = '2025-12-16 10:30:00'` (–ø—Ä–∏–º–µ—Ä)
- `premium_reason = '–û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ PayPal, invoice #12345'`
- –í—Å–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–Ω—è—Ç—ã

---

### –ü—Ä–∏–º–µ—Ä 3: –ë–µ—Å—Å—Ä–æ—á–Ω—ã–π –ø—Ä–µ–º–∏—É–º –¥–ª—è —Å–ø–æ–Ω—Å–æ—Ä–∞
```bash
/setpremium 987654321 permanent –°–ø–æ–Ω—Å–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞, $100/–º–µ—Å—è—Ü
```

**SQL —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç:**
```sql
UPDATE users
SET user_level = 'premium',
    premium_expires_at = NULL,
    premium_reason = '–°–ø–æ–Ω—Å–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞, $100/–º–µ—Å—è—Ü',
    updated_at = CURRENT_TIMESTAMP
WHERE user_id = 987654321;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- `user_level = 'premium'`
- `premium_expires_at = NULL` (–±–µ—Å—Å—Ä–æ—á–Ω–æ)
- `premium_reason = '–°–ø–æ–Ω—Å–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞, $100/–º–µ—Å—è—Ü'`

---

### –ü—Ä–∏–º–µ—Ä 4: –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞
```bash
/setlevel 555555555 moderator
```

**SQL —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç:**
```sql
UPDATE users
SET user_level = 'moderator',
    updated_at = CURRENT_TIMESTAMP
WHERE user_id = 555555555;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- `user_level = 'moderator'`
- `premium_expires_at` –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è (–≤—Å–µ–≥–¥–∞ –ø—Ä–µ–º–∏—É–º)
- –î–æ—Å—Ç—É–ø –∫ –∫–æ–º–∞–Ω–¥–∞–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

---

### –ü—Ä–∏–º–µ—Ä 5: –ò—Å—Ç–µ—á–µ–Ω–∏–µ –ø—Ä–µ–º–∏—É–º–∞

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å:
- `user_level = 'premium'`
- `premium_expires_at = '2025-11-15 23:59:59'`

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ 2025-11-15 23:59:59:**
- `IsPremium()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `false`
- –ü—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è basic –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `user_level` –æ—Å—Ç–∞–µ—Ç—Å—è 'premium' (–Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- `/create` –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è (–µ—Å–ª–∏ –∏—Å—Ç–µ–∫ —Ç–µ—Å—Ç–æ–≤—ã–π –ø–µ—Ä–∏–æ–¥)

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞—Ç—å:**
```sql
UPDATE users
SET user_level = 'basic',
    premium_expires_at = NULL,
    premium_reason = NULL,
    updated_at = CURRENT_TIMESTAMP
WHERE user_level = 'premium'
AND premium_expires_at IS NOT NULL
AND premium_expires_at <= datetime('now', '-30 days');
```

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è Basic –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ß–µ—Ç–∫–æ –∏–Ω—Ñ–æ—Ä–º–∏—Ä—É–π—Ç–µ –æ —Ç–µ—Å—Ç–æ–≤–æ–º –ø–µ—Ä–∏–æ–¥–µ
- –ü–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è –≤ `/stat`
- –ü—Ä–µ–¥–ª–∞–≥–∞–π—Ç–µ –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ premium –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è

### –î–ª—è Premium –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –í—Å–µ–≥–¥–∞ –∑–∞–ø–æ–ª–Ω—è–π—Ç–µ `premium_reason` –¥–ª—è –∞—É–¥–∏—Ç–∞
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/setpremium` –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ SQL
- –£–≤–µ–¥–æ–º–ª—è–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞ 7 –¥–Ω–µ–π –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
- –ü—Ä–µ–¥–ª–∞–≥–∞–π—Ç–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ

### –î–ª—è Moderator
- –ù–∞–∑–Ω–∞—á–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤ (5-10)
- –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è

### –î–ª—è Admin
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ (2-3)
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é Telegram
- –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ –¥–µ–π—Å—Ç–≤–∏–π
- –ü–µ—Ä–≤—ã–π admin —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ SQL

---

## –ú–∏–≥—Ä–∞—Ü–∏—è –º–µ–∂–¥—É —É—Ä–æ–≤–Ω—è–º–∏

### Basic ‚Üí Premium
```bash
/setpremium <user_id> <days> <reason>
```

### Premium ‚Üí Basic (–∏—Å—Ç–µ—á–µ–Ω–∏–µ)
```sql
UPDATE users
SET user_level = 'basic',
    premium_expires_at = NULL,
    premium_reason = NULL
WHERE user_id = ?;
```

### Basic/Premium ‚Üí Moderator
```bash
/setlevel <user_id> moderator
```

### Moderator ‚Üí Admin
```bash
/setlevel <user_id> admin
```

### Admin ‚Üí Moderator (–ø–æ–Ω–∏–∂–µ–Ω–∏–µ)
```bash
/setlevel <user_id> moderator
```

### –õ—é–±–æ–π ‚Üí Basic (—Å–±—Ä–æ—Å)
```bash
/setlevel <user_id> basic
```

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –í–∞–∂–Ω–æ:
- ‚ö†Ô∏è –ü–µ—Ä–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –¢–û–õ–¨–ö–û —á–µ—Ä–µ–∑ –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –ë–î
- ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ `user_id` –ø–µ—Ä–µ–¥ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ–º admin
- ‚ö†Ô∏è –õ–æ–≥–∏—Ä—É–π—Ç–µ –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —É—Ä–æ–≤–Ω–µ–π
- ‚ö†Ô∏è –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `premium_reason` –¥–ª—è –∞—É–¥–∏—Ç–∞
